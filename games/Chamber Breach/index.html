<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Chamber Breach FPS</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
    <script type="importmap">
      {
        "imports": {
          "three": "https://esm.sh/three@0.160.0",
          "three/": "https://esm.sh/three@0.160.0/",
          "tone": "https://esm.sh/tone@14.8.49"
        }
      }
    </script>
    <style>
      html, body { margin: 0; padding: 0; background-color: black; color: #00ff00; font-family: 'Orbitron', sans-serif; overflow: hidden; }
      
      /* CRT / Scanline Filter */
      #crt-overlay {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%), linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06));
        background-size: 100% 4px, 3px 100%;
        pointer-events: none; z-index: 500; opacity: 0.15;
      }
      #crt-overlay::after {
        content: " "; display: block; position: absolute; top: 0; left: 0; bottom: 0; right: 0;
        background: rgba(18, 16, 16, 0.1); opacity: 0; z-index: 500; pointer-events: none;
      }
      #crt-overlay.hacking {
        opacity: 0.4;
        animation: flicker 0.1s infinite;
      }
      
      /* Heat Progression Effects */
      #heat-vignette {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        pointer-events: none; z-index: 490;
        box-shadow: inset 0 0 100px rgba(255, 0, 0, 0);
        transition: box-shadow 1s ease;
      }
      #heat-glitch-overlay {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        pointer-events: none; z-index: 495;
        opacity: 0;
        mix-blend-mode: color-dodge;
        background: url('https://rosebud.ai/assets/noise_texture.png.webp?8pXv');
        background-size: 200px;
      }
      
      @keyframes glitch-flicker {
        0% { opacity: 0.05; transform: translate(0, 0); }
        10% { opacity: 0.15; transform: translate(-5px, 2px); }
        20% { opacity: 0.05; transform: translate(5px, -2px); }
        30% { opacity: 0.2; transform: translate(-2px, -5px); }
        40% { opacity: 0.1; transform: translate(2px, 5px); }
        100% { opacity: 0.05; transform: translate(0, 0); }
      }

      @keyframes flicker {
        0% { opacity: 0.27; } 5% { opacity: 0.35; } 10% { opacity: 0.3; } 15% { opacity: 0.4; } 20% { opacity: 0.3; } 100% { opacity: 0.35; }
      }

      /* Screens */
      .screen {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        display: flex; flex-direction: column; align-items: center; justify-content: center;
        background: #000; z-index: 1000; pointer-events: auto;
      }
      #start-screen { 
        background: url('https://rosebud.ai/assets/game_hero_background.webp?07BT') no-repeat center center;
        background-size: cover;
        position: relative;
        overflow: hidden;
      }
      #start-screen::before {
        content: "";
        position: absolute;
        top: 0; left: 0; width: 100%; height: 100%;
        background: linear-gradient(to bottom, rgba(0,0,0,0.2) 0%, rgba(0,0,0,0.8) 100%);
        z-index: 1;
      }
      
      /* Glitch Effect for Title */
      .glitch {
        position: relative;
        z-index: 2;
        animation: glitch-anim 5s infinite;
      }
      @keyframes glitch-anim {
        0% { transform: translate(0); }
        1% { transform: translate(-2px, 2px); }
        2% { transform: translate(2px, -2px); }
        3% { transform: translate(0); }
        100% { transform: translate(0); }
      }

      /* Scanning Line */
      .scanline {
        position: absolute;
        top: 0; left: 0; width: 100%; height: 50px;
        background: linear-gradient(to bottom, transparent, rgba(0, 255, 170, 0.1), transparent);
        z-index: 2;
        pointer-events: none;
        animation: scan 4s linear infinite;
      }
      @keyframes scan {
        0% { top: -50px; }
        100% { top: 100%; }
      }

      .title { font-size: 72px; letter-spacing: 15px; color: #00ffaa; text-shadow: 0 0 20px rgba(0, 255, 170, 0.5); margin-bottom: 20px; text-align: center; position: relative; z-index: 2; }
      .subtitle { font-size: 18px; letter-spacing: 5px; color: #00ffaa; opacity: 0.6; margin-bottom: 60px; position: relative; z-index: 2; }
      
      .deploy-btn {
        padding: 20px 60px; font-size: 24px; font-family: 'Orbitron', sans-serif;
        background: rgba(0,0,0,0.6); border: 2px solid #00ffaa; color: #00ffaa;
        cursor: pointer; transition: all 0.3s; letter-spacing: 5px;
        position: relative; z-index: 2;
        backdrop-filter: blur(5px);
      }
      .deploy-btn:hover { background: rgba(0, 255, 170, 0.2); box-shadow: 0 0 30px rgba(0, 255, 170, 0.4); transform: scale(1.05); }

      .loadout-grid { display: flex; gap: 40px; margin-bottom: 60px; }
      .loadout-card {
        width: 300px; padding: 20px; border: 1px solid rgba(0, 255, 255, 0.3);
        background: rgba(0, 20, 30, 0.5); text-align: center; transition: all 0.3s;
      }
      .loadout-card img { width: 100%; height: 180px; object-fit: contain; margin-bottom: 20px; filter: drop-shadow(0 0 10px rgba(0, 255, 255, 0.3)); }
      .loadout-card .name { font-size: 20px; color: #00ffff; margin-bottom: 10px; }
      .loadout-card .stats-mini { font-size: 12px; color: #aaa; text-align: left; line-height: 1.6; }

      #ui { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; opacity: 0; transition: opacity 1s; }
      #crosshair { 
        position: absolute; top: 50%; left: 50%; width: 20px; height: 20px; 
        border: 2px solid rgba(0, 255, 0, 0.5); border-radius: 50%; 
        transform: translate(-50%, -50%); 
      }
      #crosshair::after, #crosshair::before {
        content: ''; position: absolute; background: rgba(0, 255, 0, 0.5);
      }
      #crosshair::before { top: 50%; left: -5px; width: 30px; height: 2px; margin-top: -1px; }
      #crosshair::after { left: 50%; top: -5px; height: 30px; width: 2px; margin-left: -1px; }
      
      .stats { position: absolute; padding: 20px; font-size: 24px; text-shadow: 2px 2px #000; }
      #health { bottom: 0; left: 0; }
      #ammo { bottom: 0; right: 0; color: #ffaa00; text-align: right; }
      .weapon-slot { margin-top: 5px; opacity: 0.5; transition: opacity 0.2s; display: flex; flex-direction: column; align-items: flex-end; }
      .weapon-slot.active { opacity: 1; border-right: 4px solid #00ff00; padding-right: 10px; }
      .ammo-variant-container { display: flex; align-items: center; gap: 8px; justify-content: flex-end; }
      .ammo-icon { width: 24px; height: 24px; object-fit: contain; filter: drop-shadow(0 0 5px currentColor); }
      #score { top: 0; right: 0; }
      #chamber-progress {
        position: absolute; top: 20px; left: 50%; transform: translateX(-50%);
        width: 300px; text-align: center; font-size: 14px;
      }
      #chamber-progress-bar-container {
        width: 100%; height: 8px; background: rgba(0, 50, 0, 0.3); border: 1px solid #00ffaa; margin-top: 5px;
      }
      #chamber-progress-bar {
        width: 0%; height: 100%; background: #00ffaa; box-shadow: 0 0 10px #00ffaa; transition: width 0.3s;
      }

      .mod-indicator-container {
        display: flex;
        gap: 6px;
        margin-top: 4px;
      }
      .mod-group {
        display: flex;
        flex-direction: column;
        align-items: center;
      }
      .mod-label {
        font-size: 8px;
        opacity: 0.7;
        margin-bottom: 2px;
        color: #fff;
      }
      .mod-pips {
        display: flex;
        gap: 2px;
      }
      .mod-pip {
        width: 6px;
        height: 3px;
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.1);
      }
      .mod-pip.filled.dmg { background: #ff4400; box-shadow: 0 0 5px #ff4400; border-color: #ff4400; }
      .mod-pip.filled.fireRate { background: #ffaa00; box-shadow: 0 0 5px #ffaa00; border-color: #ffaa00; }
      .mod-pip.filled.magazine { background: #00aaff; box-shadow: 0 0 5px #00aaff; border-color: #00aaff; }
      .mod-pip.filled.reload { background: #00ffaa; box-shadow: 0 0 5px #00ffaa; border-color: #00ffaa; }

      #instructions { 
          position: absolute; bottom: 5%; left: 50%; transform: translateX(-50%); 
          text-align: center; font-size: 11px; opacity: 0.5; width: 90%;
          letter-spacing: 1px; pointer-events: none;
      }

      #scope-overlay {
        position: absolute; top: 0; left: 0; width: 100%; height: 100%;
        display: none; pointer-events: none;
        background: radial-gradient(circle, transparent 30%, black 70%);
        border: 2px solid #00ff00;
        box-sizing: border-box;
      }
      #scope-crosshair {
        position: absolute; top: 50%; left: 50%; width: 100%; height: 2px;
        background: rgba(0, 255, 0, 0.5); transform: translateY(-50%);
      }
      #scope-crosshair-v {
        position: absolute; top: 0; left: 50%; width: 2px; height: 100%;
        background: rgba(0, 255, 0, 0.5); transform: translateX(-50%);
      }
      #scope-circle {
        position: absolute; top: 50%; left: 50%; width: 400px; height: 400px;
        border: 2px solid #00ff00; border-radius: 50%;
        transform: translate(-50%, -50%);
      }

      /* Tactical Radar UI */
      #radar-ui {
        position: absolute; bottom: 20px; left: 20px; width: 120px; height: 120px;
        background: rgba(0, 20, 0, 0.8); border: 2px solid #00ffaa; border-radius: 50%;
        box-shadow: 0 0 15px rgba(0, 255, 170, 0.2); pointer-events: none; overflow: hidden;
      }
      #radar-grid {
        position: absolute; width: 100%; height: 100%;
        background-image: radial-gradient(rgba(0, 255, 170, 0.2) 1px, transparent 1px);
        background-size: 20px 20px;
      }
      #radar-grid::before {
        content: ''; position: absolute; top: 50%; left: 0; width: 100%; height: 1px; background: rgba(0, 255, 170, 0.2);
      }
      #radar-grid::after {
        content: ''; position: absolute; left: 50%; top: 0; width: 1px; height: 100%; background: rgba(0, 255, 170, 0.2);
      }
      #radar-content { position: absolute; width: 100%; height: 100%; }
      .radar-dot {
        position: absolute; width: 4px; height: 4px; border-radius: 50%; transform: translate(-50%, -50%);
      }
      .radar-dot.ally { background: #00ffaa; box-shadow: 0 0 5px #00ffaa; }
      .radar-dot.hostile { background: #ff4400; box-shadow: 0 0 5px #ff4400; }
      #radar-player {
        position: absolute; top: 50%; left: 50%; width: 0; height: 0;
        border-left: 5px solid transparent; border-right: 5px solid transparent;
        border-bottom: 8px solid #ffffff; transform: translate(-50%, -50%);
      }
    </style>
  </head>
  <body>
    <!-- Intro Screen -->
    <div id="intro-screen" class="screen" style="display: none; background: #000; flex-direction: column; justify-content: center; align-items: center; padding: 40px;">
      <div id="intro-text" style="width: 80%; max-width: 800px; font-size: 18px; line-height: 1.8; color: #00ffaa; text-shadow: 0 0 10px rgba(0, 255, 170, 0.3); font-family: monospace;">
        <!-- Text injected via script -->
      </div>
      <button id="skip-intro-btn" class="deploy-btn" style="position: absolute; bottom: 60px; left: 50%; transform: translateX(-50%); font-size: 14px; padding: 15px 40px; opacity: 0.8; border-color: rgba(0, 255, 170, 0.5);">SKIP INTRO [SPACE]</button>
    </div>

    <!-- Facility Selection Screen -->
    <div id="facility-screen" class="screen" style="display: none; background: #000; overflow: hidden;">
      <div class="scanline"></div>
      <div style="position: absolute; top: 40px; left: 40px; z-index: 10;">
        <div class="title" style="font-size: 32px; text-align: left; margin-bottom: 0;">GLOBAL NETWORK INTERFACE</div>
        <div class="subtitle" style="text-align: left; font-size: 12px; letter-spacing: 2px;">SELECT TARGET NODE FOR INFILTRATION</div>
        <div id="global-meta-credits" style="color: #ffff00; font-size: 14px; margin-top: 10px; letter-spacing: 2px;">META-CREDITS: 0</div>
      </div>

      <div style="position: absolute; top: 40px; right: 40px; z-index: 10;">
          <button id="open-meta-store-btn" class="deploy-btn" style="font-size: 12px; padding: 10px 30px; border-color: #ffff00; color: #ffff00;">UPGRADE ARCHITECTURE</button>
      </div>
      
      <div id="facility-map-container" style="position: relative; width: 100%; height: 100%; cursor: crosshair;">
         <!-- Map background grid -->
         <div style="position: absolute; width: 100%; height: 100%; background-image: radial-gradient(rgba(0, 255, 170, 0.05) 1px, transparent 1px); background-size: 40px 40px;"></div>
         <!-- Nodes and connections injected via JS -->
      </div>

      <!-- Meta Store Panel -->
      <div id="meta-store-panel" style="position: absolute; left: 0; top: 0; height: 100%; width: 450px; background: rgba(5, 5, 10, 0.95); border-right: 1px solid #ffff00; padding: 60px 40px; transform: translateX(-100%); transition: transform 0.4s cubic-bezier(0.16, 1, 0.3, 1); z-index: 30; box-shadow: 10px 0 30px rgba(0, 0, 0, 0.5); backdrop-filter: blur(10px);">
          <div style="font-size: 28px; color: #ffff00; margin-bottom: 10px; border-bottom: 2px solid #ffff00; padding-bottom: 10px;">CORE UPGRADES</div>
          <div style="font-size: 10px; color: #ffff00; opacity: 0.6; margin-bottom: 30px; letter-spacing: 4px;">PERSISTENT ARCHITECTURE MODIFICATION</div>
          
          <div id="meta-upgrades-list" style="display: flex; flex-direction: column; gap: 15px; margin-bottom: 40px;">
              <!-- Meta upgrades injected via JS -->
          </div>
          
          <button id="meta-store-close-btn" class="deploy-btn" style="width: 100%; font-size: 14px; padding: 15px; border-color: #555; color: #555;">RETURN TO MAP</button>
      </div>

      <!-- Facility Detail Sidebar -->
      <div id="facility-detail-panel" style="position: absolute; right: 0; top: 0; height: 100%; width: 400px; background: rgba(0, 15, 10, 0.9); border-left: 1px solid #00ffaa; padding: 60px 40px; transform: translateX(100%); transition: transform 0.4s cubic-bezier(0.16, 1, 0.3, 1); z-index: 20; box-shadow: -10px 0 30px rgba(0, 0, 0, 0.5); backdrop-filter: blur(10px);">
          <div id="detail-name" style="font-size: 28px; color: #00ffaa; margin-bottom: 10px; border-bottom: 2px solid #00ffaa; padding-bottom: 10px;">FACILITY NAME</div>
          <div id="detail-location" style="font-size: 10px; color: #00ffaa; opacity: 0.6; margin-bottom: 20px; letter-spacing: 4px;">COORDINATES: X-72 Y-44</div>
          
          <div style="width: 100%; height: 180px; background: rgba(0,0,0,0.5); border: 1px solid rgba(0, 255, 170, 0.3); margin-bottom: 30px; overflow: hidden; position: relative;">
            <img id="detail-image" style="width: 100%; height: 100%; object-fit: cover; opacity: 0.7; filter: brightness(1.2) contrast(1.1) saturate(1.2);">
            <div style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(rgba(0, 255, 170, 0.1), transparent); pointer-events: none;"></div>
            <div style="position: absolute; bottom: 0; left: 0; width: 100%; height: 2px; background: #00ffaa; box-shadow: 0 0 10px #00ffaa;"></div>
          </div>

          <div style="color: #00ffaa; font-size: 12px; margin-bottom: 10px; letter-spacing: 2px; text-transform: uppercase;">Node Overview</div>
          <div id="detail-desc" style="font-size: 14px; color: #aaa; line-height: 1.6; margin-bottom: 30px; height: 100px; overflow-y: auto;">Description goes here...</div>
          
          <div style="background: rgba(0, 255, 170, 0.05); border: 1px dashed rgba(0, 255, 170, 0.3); padding: 20px; margin-bottom: 40px;">
              <div style="color: #00ffaa; font-size: 10px; margin-bottom: 15px; text-align: center; letter-spacing: 3px;">TACTICAL SCAN DATA</div>
              <div id="detail-stats" style="font-family: monospace; font-size: 12px; line-height: 2.0; color: #fff;">
                  SECURITY CLASS: TITAN-IV<br>
                  ROOM COUNT: 50<br>
                  RISK LEVEL: EXTREME<br>
                  SIGNAL: ENCRYPTED-L3
              </div>
          </div>
          
          <button id="detail-confirm-btn" class="deploy-btn" style="width: 100%; font-size: 18px; padding: 20px;">INITIATE BREACH</button>
          <div style="margin-top: 20px; text-align: center; font-size: 10px; color: #00ffaa; opacity: 0.4;">WARNING: DEPLOYMENT IS PERMANENT FOR MISSION DURATION</div>
      </div>

      <button id="facility-back-btn" class="deploy-btn" style="position: absolute; bottom: 40px; left: 40px; font-size: 12px; padding: 10px 30px; border-color: #555; color: #555; z-index: 10;">ABORT MISSION</button>
    </div>

    <!-- Start Screen -->
    <div id="start-screen" class="screen">
      <div class="scanline"></div>
      <div class="title glitch">CHAMBER BREACH</div>
      <div class="subtitle">DATA CENTER INFILTRATION PROTOCOL</div>
      <div style="display: flex; gap: 20px; z-index: 2;">
        <button id="start-btn" class="deploy-btn">INITIALIZE</button>
        <button id="skip-all-btn" class="deploy-btn" style="font-size: 14px; border-color: #555; color: #888;">SKIP INTRO</button>
      </div>
    </div>

    <!-- Breach Loading Screen -->
    <div id="breach-loading-screen" class="screen" style="display: none; background: #000; flex-direction: column; align-items: center; justify-content: center; padding: 40px; font-family: monospace;">
      <div class="scanline"></div>
      <div style="width: 80%; max-width: 800px; height: 400px; border: 1px solid #00ffaa; background: rgba(0, 20, 10, 0.9); padding: 20px; position: relative; display: flex; flex-direction: column;">
        <div style="color: #00ffaa; font-size: 18px; margin-bottom: 20px; border-bottom: 1px solid rgba(0, 255, 170, 0.3); padding-bottom: 10px; display: flex; justify-content: space-between;">
          <span>LINK ESTABLISHED: BREACH IN PROGRESS</span>
          <span id="breach-percent">0%</span>
        </div>
        <div id="terminal-logs" style="flex-grow: 1; overflow: hidden; color: #00ffaa; font-size: 12px; line-height: 1.5; opacity: 0.8;">
          <!-- Logs injected via JS -->
        </div>
        <div style="width: 100%; height: 4px; background: rgba(0, 50, 0, 0.5); margin-top: 20px;">
          <div id="breach-loading-bar" style="width: 0%; height: 100%; background: #00ffaa; box-shadow: 0 0 10px #00ffaa; transition: width 0.1s;"></div>
        </div>
      </div>
      <div style="margin-top: 40px; color: #00ffaa; font-size: 14px; letter-spacing: 5px; animation: pulse 1.5s infinite;">INITIALIZING NEURAL LINK...</div>
    </div>

    <!-- Extraction Screen -->
    <div id="extraction-screen" class="screen" style="display: none; background: #000; padding: 40px; text-align: center;">
      <div class="scanline"></div>
      <div class="title glitch" style="color: #00ffff; text-shadow: 0 0 20px rgba(0, 255, 255, 0.5);">EXTRACTION SUCCESSFUL</div>
      <div class="subtitle">NEURAL LINK SEVERED - DATA SECURED</div>
      
      <div style="width: 80%; max-width: 600px; margin: 40px auto; border: 1px solid #00ffff; background: rgba(0, 40, 50, 0.3); padding: 30px;">
        <div style="display: flex; justify-content: space-between; margin-bottom: 20px;">
          <span style="color: #aaa;">CHAMBERS BREACHED:</span>
          <span id="extract-chambers" style="color: #00ffff;">50 / 50</span>
        </div>
        <div style="display: flex; justify-content: space-between; margin-bottom: 20px;">
          <span style="color: #aaa;">DATA PACKETS COLLECTED:</span>
          <span id="extract-score" style="color: #00ffff;">12,500</span>
        </div>
        <div style="display: flex; justify-content: space-between; margin-bottom: 20px; border-top: 1px solid rgba(0, 255, 255, 0.3); padding-top: 20px;">
          <span style="color: #ffff00; font-weight: bold;">META-CREDITS EARNED:</span>
          <span id="extract-meta" style="color: #ffff00; font-weight: bold;">+ 500</span>
        </div>
      </div>
      
      <div id="meta-total" style="color: #00ffff; margin-bottom: 20px; font-size: 18px;">TOTAL PERSISTENT CREDITS: 0</div>
      
      <!-- Architectural Sync Breakdown -->
      <div style="width: 80%; max-width: 600px; margin: 0 auto 40px auto; padding: 20px; border: 1px dashed rgba(0, 255, 255, 0.3); background: rgba(0, 255, 255, 0.02);">
        <div style="color: #00ffff; font-size: 10px; letter-spacing: 3px; margin-bottom: 15px; opacity: 0.6;">PERSISTENT ARCHITECTURE STATUS</div>
        <div id="extract-meta-breakdown" style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; font-size: 11px; text-align: left; font-family: monospace;">
          <!-- Injected via JS -->
        </div>
      </div>
      
      <button id="extract-return-btn" class="deploy-btn" style="border-color: #00ffff; color: #00ffff;">RETURN TO NETWORK MAP</button>
    </div>

    <!-- Death Screen -->
    <div id="death-screen" class="screen" style="display: none; background: #000; padding: 40px; text-align: center; border: 20px solid rgba(255, 0, 0, 0.1);">
      <div id="death-glitch-overlay" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255, 0, 0, 0.05); pointer-events: none; z-index: -1;"></div>
      <div class="scanline" style="background: linear-gradient(to bottom, transparent, rgba(255, 0, 0, 0.1), transparent);"></div>
      <div class="title glitch" style="color: #ff3300; text-shadow: 0 0 20px rgba(255, 51, 0, 0.5);">SYSTEM FATAL ERROR</div>
      <div class="subtitle" style="color: #ff3300; letter-spacing: 10px;">NEURAL LINK COLLAPSED - OPERATOR FLATLINED</div>
      
      <div style="width: 80%; max-width: 600px; margin: 40px auto; border: 1px solid #ff3300; background: rgba(50, 0, 0, 0.3); padding: 30px; font-family: monospace; text-align: left; position: relative;">
        <div style="position: absolute; top: 0; right: 0; padding: 10px; font-size: 10px; color: #ff3300; opacity: 0.5;">ERROR_CODE: 0xDEADBEEF</div>
        <div style="color: #ff3300; margin-bottom: 20px; font-size: 18px; border-bottom: 1px solid rgba(255, 51, 0, 0.3); padding-bottom: 10px;">POST-MORTEM DIAGNOSTICS:</div>
        <div style="display: flex; justify-content: space-between; margin-bottom: 15px;">
          <span style="color: #880000;">BREACH DEPTH:</span>
          <span id="death-chambers" style="color: #ff3300; font-weight: bold;">12 / 50</span>
        </div>
        <div style="display: flex; justify-content: space-between; margin-bottom: 15px;">
          <span style="color: #880000;">DATA RECOVERED:</span>
          <span id="death-score" style="color: #ff3300; font-weight: bold;">4,200</span>
        </div>
        <div style="display: flex; justify-content: space-between; margin-bottom: 15px;">
          <span style="color: #880000;">SCRAP LOST:</span>
          <span id="death-scrap-lost" style="color: #ff3300;">0</span>
        </div>
        <div style="margin-top: 20px; color: #ff3300; font-size: 12px; line-height: 1.5; opacity: 0.8; border-top: 1px dashed rgba(255, 0, 0, 0.2); padding-top: 15px;">
          CRITICAL: BIO-SIGNATURE LOST. DATA BUFFER PURGED. MISSION CREDITS NULLIFIED.<br><br>
          <span style="color: #ffaa00;">PERSISTENT ARCHITECTURE REMAINS INTACT.</span><br>
          RE-INITIALIZING CLONE SEQUENCE IN SECTOR 0...
        </div>

        <!-- Persistent Status in Death Screen -->
        <div id="death-meta-breakdown" style="margin-top: 20px; display: grid; grid-template-columns: 1fr 1fr; gap: 8px; font-size: 10px; font-family: monospace; border-top: 1px solid rgba(255, 51, 0, 0.2); padding-top: 10px;">
          <!-- Injected via JS -->
        </div>
      </div>
      
      <div style="display: flex; gap: 20px;">
        <button id="death-restart-btn" class="deploy-btn" style="border-color: #ff3300; color: #ff3300;">RE-INITIALIZE LINK</button>
      </div>
    </div>

    <style>
      @keyframes pulse {
        0% { opacity: 0.4; }
        50% { opacity: 1; }
        100% { opacity: 0.4; }
      }
      .terminal-log-entry {
        margin-bottom: 4px;
        white-space: nowrap;
      }
      .terminal-log-entry.warning { color: #ffff00; }
      .terminal-log-entry.error { color: #ff0000; }
      .terminal-log-entry.success { color: #00ffaa; }
    </style>

    <!-- Mission Briefing Screen -->
    <div id="briefing-screen" class="screen" style="display: none; background: #000; padding: 40px;">
      <div style="width: 80%; max-width: 900px; border: 1px solid #00ffaa; background: rgba(0, 20, 10, 0.8); padding: 40px; box-shadow: 0 0 40px rgba(0, 255, 170, 0.2);">
        <div id="brief-facility-name" class="title" style="font-size: 36px; margin-bottom: 30px; border-bottom: 2px solid #00ffaa; padding-bottom: 10px; text-align: left;">FACILITY NAME</div>
        
        <div style="display: grid; grid-template-columns: 1.2fr 1fr 1fr; gap: 20px; margin-bottom: 40px;">
          <div>
            <div style="width: 100%; height: 140px; border: 1px solid rgba(0, 255, 170, 0.4); margin-bottom: 20px; overflow: hidden; position: relative; background: #000;">
              <img id="brief-image" style="width: 100%; height: 100%; object-fit: cover; opacity: 0.8; filter: brightness(1.1) contrast(1.1);">
              <div style="position: absolute; bottom: 0; left: 0; width: 100%; height: 2px; background: #00ffaa; box-shadow: 0 0 10px #00ffaa;"></div>
            </div>
            <div style="color: #00ffaa; font-size: 14px; margin-bottom: 15px; letter-spacing: 2px;">TACTICAL INTEL</div>
            <div id="brief-desc" style="font-size: 13px; line-height: 1.6; color: #aaa; margin-bottom: 20px;">Facility description goes here.</div>
            
            <div style="color: #00ffaa; font-size: 14px; margin-bottom: 10px; letter-spacing: 2px;">PRIMARY OBJECTIVE</div>
            <div id="brief-objective" style="font-size: 14px; color: #fff; font-weight: bold; padding: 10px; border-left: 3px solid #ffff00; background: rgba(255, 255, 0, 0.05);">NEUTRALIZE CORE SYSTEMS</div>
          </div>

          <!-- Network Map Column -->
          <div style="background: rgba(0, 255, 170, 0.02); border: 1px solid rgba(0, 255, 170, 0.1); position: relative; height: 250px; overflow: hidden;">
            <div style="color: #00ffaa; font-size: 10px; padding: 5px; text-align: center; border-bottom: 1px solid rgba(0, 255, 170, 0.1);">MERIDIAN NETWORK MAP</div>
            <div id="brief-map-container" style="position: relative; width: 100%; height: 215px; background: radial-gradient(circle, rgba(0,255,170,0.05) 0%, transparent 70%);">
              <!-- Nodes will be injected here -->
              <div id="map-grid-overlay" style="position: absolute; width: 100%; height: 100%; background-image: radial-gradient(rgba(0, 255, 170, 0.1) 1px, transparent 1px); background-size: 20px 20px;"></div>
            </div>
          </div>
          
          <div style="background: rgba(0, 0, 0, 0.5); padding: 15px; border: 1px dashed rgba(0, 255, 170, 0.3);">
            <div style="color: #00ffaa; font-size: 10px; margin-bottom: 15px; text-align: center; letter-spacing: 3px;">FACILITY SCAN DATA</div>
            <div id="brief-stats" style="font-family: monospace; font-size: 11px; line-height: 1.8;">
              SECURITY CLASS: [REDACTED]<br>
              ROOM COUNT: --<br>
              HAZARD LEVEL: --<br>
              SIGNAL PROFILE: --<br>
              SPECIALIZED UNIT: --
            </div>
          </div>
        </div>

        <style>
          .map-node {
            position: absolute;
            width: 10px; height: 10px;
            background: #111;
            border: 1px solid #00ffaa;
            border-radius: 50%;
            transform: translate(-50%, -50%);
            cursor: pointer;
            transition: all 0.3s;
            z-index: 5;
          }
          .map-node:hover {
            box-shadow: 0 0 15px #00ffaa;
            scale: 1.2;
          }
          .map-node.active {
            background: #00ffaa;
            box-shadow: 0 0 20px #00ffaa;
            scale: 1.4;
          }
          .map-node-label {
            position: absolute;
            top: 15px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 8px;
            color: #00ffaa;
            white-space: nowrap;
            pointer-events: none;
            text-transform: uppercase;
            opacity: 0.6;
          }
          .map-line {
            position: absolute;
            background: rgba(0, 255, 170, 0.15);
            height: 1px;
            transform-origin: left center;
            z-index: 1;
            pointer-events: none;
          }
        </style>
        
        <div style="display: flex; justify-content: space-between; align-items: flex-end;">
          <div style="font-size: 10px; color: #00ffaa; opacity: 0.5;">SECURE LINE ESTABLISHED | ENCRYPTION: 4096-BIT RSA</div>
          <div style="display: flex; gap: 20px;">
            <button id="open-achievement-gallery-btn" class="deploy-btn" style="font-size: 12px; padding: 10px 30px; border-color: #ffff00; color: #ffff00;">TACTICAL MILESTONES</button>
            <button id="brief-back-btn" class="deploy-btn" style="font-size: 12px; padding: 10px 30px; border-color: #555; color: #555;">ABORT</button>
            <button id="brief-proceed-btn" class="deploy-btn" style="font-size: 12px; padding: 10px 30px;">PROCEED TO ARMORY</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Achievement Gallery Panel -->
    <div id="achievement-gallery-panel" class="screen" style="display: none; background: rgba(0, 0, 0, 0.95); padding: 40px;">
        <div style="width: 80%; max-width: 800px; border: 1px solid #ffff00; background: rgba(20, 20, 0, 0.9); padding: 40px; box-shadow: 0 0 40px rgba(255, 255, 0, 0.2); position: relative;">
            <div class="title" style="font-size: 32px; color: #ffff00; margin-bottom: 30px; border-bottom: 2px solid #ffff00; padding-bottom: 10px; text-align: left;">TACTICAL MILESTONES</div>
            
            <div id="achievement-list" style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; max-height: 500px; overflow-y: auto; padding-right: 15px;">
                <!-- Achievements injected via JS -->
            </div>
            
            <button id="achievement-gallery-close-btn" class="deploy-btn" style="margin-top: 30px; width: 100%; border-color: #ffff00; color: #ffff00;">CLOSE RECORDS</button>
        </div>
    </div>

    <!-- Loadout Screen -->
    <div id="loadout-screen" class="screen" style="display: none;">
      <div class="title" style="font-size: 48px;">ARMORY ACCESS</div>
      <div style="display: flex; align-items: center; gap: 20px; margin-bottom: 30px;">
        <div class="subtitle" style="margin-bottom: 0;">ALLOCATE MISSION CREDITS</div>
        <div id="mission-credits" style="font-size: 24px; color: #ffff00; text-shadow: 0 0 10px rgba(255, 255, 0, 0.5);">CREDITS: 500</div>
      </div>
      
      <div class="loadout-grid">
        <div class="loadout-card">
          <img src="https://rosebud.ai/assets/rifle_display.png.webp?15vc" alt="Rifle">
          <div class="name">XM-42 RIFLE</div>
          <div class="stats-mini" id="rifle-stats-armory">
            DAMAGE: 25<br>
            FIRE RATE: 150ms<br>
            MAG SIZE: 30<br>
            MODS: 0 / 20
          </div>
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 5px; margin-top: 15px;">
            <button class="upgrade-btn" onclick="game.armoryUpgrade('RIFLE', 'damage')">DAMAGE (150)</button>
            <button class="upgrade-btn" onclick="game.armoryUpgrade('RIFLE', 'fireRate')">RATE (100)</button>
            <button class="upgrade-btn" onclick="game.armoryUpgrade('RIFLE', 'magazine')">MAG (100)</button>
            <button class="upgrade-btn" onclick="game.armoryUpgrade('RIFLE', 'reload')">RELOAD (100)</button>
          </div>
        </div>
        <div class="loadout-card">
          <img src="https://rosebud.ai/assets/sniper_display.png.webp?Ltx1" alt="Sniper">
          <div class="name">SRS-99 SNIPER</div>
          <div class="stats-mini" id="sniper-stats-armory">
            DAMAGE: 100<br>
            FIRE RATE: 1000ms<br>
            MAG SIZE: 5<br>
            MODS: 0 / 20
          </div>
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 5px; margin-top: 15px;">
            <button class="upgrade-btn" onclick="game.armoryUpgrade('SNIPER', 'damage')">DAMAGE (200)</button>
            <button class="upgrade-btn" onclick="game.armoryUpgrade('SNIPER', 'fireRate')">RATE (150)</button>
            <button class="upgrade-btn" onclick="game.armoryUpgrade('SNIPER', 'magazine')">MAG (150)</button>
            <button class="upgrade-btn" onclick="game.armoryUpgrade('SNIPER', 'reload')">RELOAD (150)</button>
          </div>
        </div>
      </div>

      <button id="deploy-btn" class="deploy-btn">DEPLOY TO CHAMBER 1</button>
    </div>

    <style>
      .facility-card {
        background: rgba(0, 255, 170, 0.05);
        border: 1px solid rgba(0, 255, 170, 0.3);
        padding: 20px;
        transition: all 0.3s;
        cursor: pointer;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
      }
      .facility-card:hover {
        background: rgba(0, 255, 170, 0.15);
        border-color: #00ffaa;
        transform: translateY(-5px);
        box-shadow: 0 0 20px rgba(0, 255, 170, 0.3);
      }
      .facility-card .name { font-size: 20px; color: #00ffaa; margin-bottom: 10px; }
      .facility-card .desc { font-size: 12px; color: #aaa; margin-bottom: 15px; flex-grow: 1; }
      .facility-card .meta { font-size: 10px; color: #00ffaa; opacity: 0.7; }
      
      .upgrade-btn {
        flex: 1; padding: 8px; background: rgba(0, 255, 170, 0.1); border: 1px solid #00ffaa;
        color: #00ffaa; font-family: 'Orbitron', sans-serif; font-size: 10px; cursor: pointer;
        transition: all 0.2s;
      }
      .upgrade-btn:hover { background: rgba(0, 255, 170, 0.3); box-shadow: 0 0 10px #00ffaa; }
    </style>

    <!-- Achievement Notification -->
    <div id="achievement-ui" style="display:none; position: fixed; top: 20px; right: 20px; width: 300px; background: rgba(0, 40, 30, 0.9); border: 2px solid #ffff00; padding: 15px; z-index: 2000; font-family: 'Orbitron', sans-serif; box-shadow: 0 0 20px rgba(255, 255, 0, 0.3); animation: slideInRight 0.5s ease-out;">
        <div style="color: #ffff00; font-size: 10px; letter-spacing: 2px; margin-bottom: 5px;">ACHIEVEMENT UNLOCKED</div>
        <div id="achievement-name" style="color: #fff; font-size: 16px; font-weight: bold; margin-bottom: 5px;">TITAN SLAYER</div>
        <div id="achievement-desc" style="color: #aaa; font-size: 11px; line-height: 1.4;">Defeat the Heavy Security Titan in Room 50.</div>
    </div>

    <style>
        @keyframes slideInRight {
            from { transform: translateX(120%); }
            to { transform: translateX(0); }
        }
        @keyframes slideOutRight {
            from { transform: translateX(0); }
            to { transform: translateX(120%); }
        }
    </style>

    <div id="crt-overlay"></div>
    <div id="heat-vignette"></div>
    <div id="heat-glitch-overlay"></div>

    <!-- Boss Health UI -->
    <div id="boss-health-container" style="display:none; position: fixed; top: 10%; left: 50%; transform: translateX(-50%); width: 400px; padding: 15px; background: rgba(0,0,0,0.85); border: 2px solid #ff3300; z-index: 550; font-family: 'Orbitron', sans-serif; color: #ff3300; box-shadow: 0 0 20px rgba(255, 51, 0, 0.3);">
        <div id="boss-name" style="margin-bottom: 10px; font-weight: bold; text-align: center; font-size: 14px; letter-spacing: 2px;">TITAN SECURITY UNIT</div>
        <div style="width: 100%; height: 12px; background: #330000; border: 1px solid #ff3300; position: relative; overflow: hidden;">
            <div id="boss-health-bar" style="width: 100%; height: 100%; background: #ff3300; box-shadow: 0 0 10px #ff3300; transition: width 0.3s ease-out;"></div>
        </div>
        <div style="font-size: 10px; margin-top: 8px; text-align: right; opacity: 0.7; letter-spacing: 1px;">THREAT LEVEL: OMEGA</div>
    </div>

    <!-- Neural Sync Hacking UI -->
    <div id="neural-sync-ui" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 600; background: rgba(0, 0, 0, 0.85); pointer-events: auto;">
        <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 500px; height: 500px; display: flex; flex-direction: column; align-items: center; justify-content: center;">
            <div style="color: #00ffaa; font-size: 24px; letter-spacing: 8px; margin-bottom: 40px; text-shadow: 0 0 10px #00ffaa; font-weight: bold;">NEURAL FREQUENCY SYNC</div>
            
            <div style="position: relative; width: 300px; height: 300px;">
                <!-- Central Core -->
                <div id="sync-core" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 40px; height: 40px; background: #00ffaa; border-radius: 50%; box-shadow: 0 0 30px #00ffaa; transition: all 0.3s;"></div>
                
                <!-- Sync Zone Indicator (Top) -->
                <div style="position: absolute; top: -10px; left: 50%; transform: translateX(-50%); width: 4px; height: 320px; background: rgba(0, 255, 170, 0.2); pointer-events: none; z-index: 1;"></div>
                <div style="position: absolute; top: -20px; left: 50%; transform: translateX(-50%); width: 20px; height: 20px; border: 2px solid #00ffaa; border-radius: 50%; z-index: 2;"></div>

                <!-- Rotating Rings -->
                <div id="sync-ring-3" class="sync-ring" style="width: 300px; height: 300px; border: 4px solid rgba(0, 255, 170, 0.1); border-top-color: #00ffaa;"></div>
                <div id="sync-ring-2" class="sync-ring" style="width: 220px; height: 220px; border: 4px solid rgba(0, 255, 170, 0.1); border-top-color: #00ffaa; margin: 40px;"></div>
                <div id="sync-ring-1" class="sync-ring" style="width: 140px; height: 140px; border: 4px solid rgba(0, 255, 170, 0.1); border-top-color: #00ffaa; margin: 80px;"></div>
            </div>

            <div id="sync-status" style="margin-top: 40px; color: #00ffaa; font-size: 14px; font-family: monospace;">ALIGNMENT: STAGE 1 / 3</div>
            <div style="margin-top: 10px; color: #00ffaa; opacity: 0.5; font-size: 10px;">PRESS [SPACE] TO LOCK FREQUENCY</div>
        </div>
    </div>

    <style>
        .sync-ring {
            position: absolute;
            top: 0; left: 0;
            border-radius: 50%;
            box-sizing: border-box;
            transition: border-color 0.3s;
        }
        .sync-ring.locked {
            border-color: #00ffaa !important;
            box-shadow: 0 0 15px #00ffaa;
        }
    </style>
    <div id="ui">
      <!-- Tactical Radar -->
      <div id="radar-ui">
          <div id="radar-grid"></div>
          <div id="radar-content"></div>
          <div id="radar-player"></div>
      </div>
      
      <div id="thermal-overlay" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; background: radial-gradient(circle, transparent 20%, rgba(0, 100, 255, 0.1) 100%); border: 40px solid rgba(0, 255, 255, 0.05); box-shadow: inset 0 0 150px rgba(0, 255, 255, 0.2); z-index: 10;"></div>
      <div id="scope-overlay">
        <div id="scope-crosshair"></div>
        <div id="scope-crosshair-v"></div>
        <div id="scope-circle"></div>
      </div>
      <div id="crosshair"></div>

      <!-- Hacking Minigame UI -->
      <div id="hacking-ui" style="display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 300px; height: 300px; background: rgba(0, 20, 0, 0.9); border: 2px solid #00ff00; border-radius: 50%; z-index: 100; box-shadow: 0 0 20px #00ff00;">
          <div style="position: absolute; top: 10px; width: 100%; text-align: center; color: #00ff00; font-size: 14px;">DRONE OVERRIDE IN PROGRESS</div>
          <div id="hacking-target-zone" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: 15px solid transparent; border-top-color: #00ffaa; border-radius: 50%; transform: rotate(0deg);"></div>
          <div id="hacking-needle" style="position: absolute; top: 50%; left: 50%; width: 2px; height: 140px; background: #ffffff; transform-origin: bottom center; transform: translate(-50%, -100%) rotate(0deg); box-shadow: 0 0 10px #ffffff;"></div>
          <div id="hacking-progress" style="position: absolute; bottom: 40px; width: 100%; text-align: center; color: #00ffaa; font-size: 20px;">0 / 3</div>
          <div style="position: absolute; bottom: 15px; width: 100%; text-align: center; color: #00ffaa; font-size: 10px;">PRESS [SPACE] IN ZONE</div>
      </div>
      <div id="hack-prompt" style="display: none; position: absolute; top: 60%; left: 50%; transform: translateX(-50%); color: #00ffaa; font-size: 18px; text-shadow: 0 0 10px #000;">PRESS [E] TO OVERRIDE DRONE</div>
      <div id="shop-prompt" style="display: none; position: absolute; top: 60%; left: 50%; transform: translateX(-50%); color: #ffaa00; font-size: 18px; text-shadow: 0 0 10px #000;">PRESS [E] TO ACCESS SHOP</div>
      <div id="terminal-prompt" style="display: none; position: absolute; top: 60%; left: 50%; transform: translateX(-50%); color: #00ffaa; font-size: 18px; text-shadow: 0 0 10px #000;">PRESS [E] TO ACCESS TERMINAL</div>
      <div id="turret-prompt" style="display: none; position: absolute; top: 60%; left: 50%; transform: translateX(-50%); color: #00ffaa; font-size: 18px; text-shadow: 0 0 10px #000;">PRESS [E] TO SERVICE TURRET</div>

      <!-- Terminal Main Menu UI -->
      <div id="terminal-menu-ui" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 450; background: rgba(0, 0, 0, 0.7); pointer-events: auto;">
          <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 450px; background: rgba(5, 10, 5, 0.95); border: 2px solid #00ffaa; padding: 30px; box-shadow: 0 0 40px rgba(0, 255, 170, 0.3);">
              <div style="text-align: center; border-bottom: 1px solid #00ffaa; padding-bottom: 15px; margin-bottom: 25px;">
                  <div style="font-size: 28px; color: #00ffaa; letter-spacing: 4px;">TERMINAL ACCESS</div>
                  <div id="term-status" style="font-size: 12px; color: #00ffaa; opacity: 0.6; margin-top: 5px;">ENCRYPTED CONNECTION ESTABLISHED</div>
              </div>
              
              <div style="display: flex; flex-direction: column; gap: 15px;">
                  <button id="term-hack-btn" class="terminal-btn-main" style="background: rgba(0, 255, 170, 0.15);">SECURITY OVERRIDE</button>
                  <button id="term-shop-btn" class="terminal-btn-main" style="background: rgba(255, 170, 0, 0.1);">BLACK MARKET ACCESS</button>
                  <button id="term-close-btn" class="terminal-btn-main" style="background: rgba(255, 50, 50, 0.05); border-color: #552222; color: #aa5555; font-size: 12px; margin-top: 10px;">DISCONNECT</button>
              </div>
          </div>
      </div>

      <!-- Terminal Shop UI -->
      <div id="terminal-shop-ui" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 460; background: rgba(0, 0, 0, 0.8); pointer-events: auto;">
          <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 700px; background: rgba(10, 8, 5, 0.98); border: 2px solid #ffaa00; padding: 30px; box-shadow: 0 0 50px rgba(255, 170, 0, 0.25);">
              <div style="display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #ffaa00; padding-bottom: 15px; margin-bottom: 20px;">
                  <div style="font-size: 24px; color: #ffaa00;">BLACK MARKET TRADING</div>
                  <div id="shop-currency-hud" style="text-align: right;">
                      <div id="shop-scrap-val" style="color: #00ffaa; font-size: 16px;">SCRAP: 0</div>
                      <div id="shop-cores-val" style="color: #ffff00; font-size: 16px;">CORES: 0</div>
                  </div>
              </div>
              
              <div id="shop-items-grid" style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; max-height: 400px; overflow-y: auto; padding-right: 10px;">
                  <!-- Items will be generated here -->
              </div>

              <div style="margin-top: 25px; display: flex; justify-content: space-between; align-items: center;">
                  <div style="font-size: 10px; color: #ffaa00; opacity: 0.6;">*ALL SALES ARE FINAL. REFUNDS NOT AVAILABLE IN SECURITY ZONES.</div>
                  <button id="shop-back-btn" class="turret-btn" style="border-color: #ffaa00; color: #ffaa00; padding: 10px 30px;">BACK</button>
              </div>
          </div>
      </div>

      <style>
          .terminal-btn-main {
              padding: 20px; border: 1px solid #00ffaa; color: #00ffaa; 
              font-family: 'Orbitron', sans-serif; cursor: pointer; transition: all 0.2s;
              font-size: 18px; text-transform: uppercase;
          }
          .terminal-btn-main:hover { box-shadow: 0 0 15px rgba(0, 255, 170, 0.4); transform: translateY(-2px); }
          
          .shop-item-card {
              background: rgba(255, 170, 0, 0.05); border: 1px solid rgba(255, 170, 0, 0.3);
              padding: 15px; transition: all 0.2s; cursor: pointer;
          }
          .shop-item-card:hover { background: rgba(255, 170, 0, 0.1); border-color: #ffaa00; }
          .shop-item-card .name { color: #ffaa00; font-weight: bold; font-size: 16px; margin-bottom: 5px; }
          .shop-item-card .desc { color: #aaa; font-size: 11px; margin-bottom: 10px; height: 30px; overflow: hidden; }
          .shop-item-card .price { color: #00ffaa; font-size: 14px; font-family: monospace; }
      </style>

      <!-- Turret Interaction UI -->
      <div id="turret-menu-ui" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 400; background: rgba(0, 0, 0, 0.6); pointer-events: auto;">
          <div class="turret-menu-content" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 500px; background: rgba(5, 15, 10, 0.95); border: 2px solid #00ffaa; padding: 25px; box-shadow: 0 0 30px rgba(0, 255, 170, 0.4);">
              <div style="display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #00ffaa; padding-bottom: 10px; margin-bottom: 20px;">
                  <div style="font-size: 24px; color: #00ffaa;">TURRET MAINTENANCE</div>
                  <div id="turret-scrap-val" style="font-size: 18px; color: #00ffaa;">SCRAP: 0</div>
              </div>
              
              <div id="turret-info" style="margin-bottom: 20px; font-size: 14px; color: #00ffaa; opacity: 0.8; line-height: 1.6;">
                  <div id="turret-info-hp">HEALTH: 100 / 100</div>
                  <div id="turret-info-dmg">DAMAGE: 10</div>
                  <div id="turret-info-fire">FIRE RATE: 500ms</div>
              </div>

              <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                  <button id="turret-repair-btn" class="turret-btn">REPAIR (10 Scrap)</button>
                  <button id="turret-dmg-btn" class="turret-btn">UPGRADE DMG (25 Scrap)</button>
                  <button id="turret-fire-btn" class="turret-btn">UPGRADE RATE (30 Scrap)</button>
                  <button id="turret-hp-btn" class="turret-btn">UPGRADE ARMOR (40 Scrap)</button>
              </div>
              <div style="margin-top: 20px; font-size: 10px; text-align: center; color: #00ffaa; opacity: 0.5;">[ESC] OR CLICK OUTSIDE TO CLOSE</div>
          </div>
      </div>

      <style>
          .turret-btn {
              padding: 15px; background: rgba(0, 255, 170, 0.1); border: 1px solid #00ffaa; color: #00ffaa; 
              font-family: 'Orbitron', sans-serif; cursor: pointer; transition: all 0.2s;
          }
          .turret-btn:hover { background: rgba(0, 255, 170, 0.2); box-shadow: 0 0 10px rgba(0, 255, 170, 0.5); }
      </style>

      <!-- Terminal Hacking UI -->
      <div id="terminal-hack-ui" style="display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 400px; padding: 20px; background: rgba(0, 10, 0, 0.9); border: 2px solid #00ffaa; border-radius: 5px; z-index: 100; text-align: center; box-shadow: 0 0 20px #00ffaa;">
          <div style="color: #00ffaa; font-size: 14px; margin-bottom: 15px; letter-spacing: 2px;">BYPASSING CHAMBER FIREWALL...</div>
          <div style="width: 100%; height: 20px; background: rgba(0, 50, 0, 0.5); border: 1px solid #00ffaa; overflow: hidden; position: relative;">
              <div id="terminal-hack-bar" style="width: 0%; height: 100%; background: #00ffaa; box-shadow: 0 0 15px #00ffaa;"></div>
          </div>
          <div id="terminal-hack-percent" style="color: #00ffaa; font-size: 12px; margin-top: 10px;">0%</div>
          <div id="terminal-hack-blocked-alert" style="display: none; color: #ff0000; font-size: 14px; font-weight: bold; margin-top: 10px; animation: pulse 0.5s infinite;">SECURITY INTERFERENCE DETECTED: CLEAR SECTOR</div>
      </div>

      <!-- Command Radial Menu -->
      <div id="radial-menu" style="display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 450px; height: 450px; z-index: 200;">
          <div style="position: absolute; top: 50%; left: 50%; width: 100px; height: 100px; background: rgba(0, 50, 0, 0.8); border: 2px solid #00ff00; border-radius: 50%; transform: translate(-50%, -50%); display: flex; align-items: center; justify-content: center; font-size: 12px; text-align: center;">COMMANDS [HOLD X]</div>
          
          <div id="radial-opt-follow" class="radial-opt" style="position: absolute; top: 0; left: 50%; transform: translateX(-50%); width: 100px; height: 100px; border: 2px solid #00ff00; border-radius: 50%; display: flex; align-items: center; justify-content: center; background: rgba(0, 20, 0, 0.6); transition: all 0.2s;">FOLLOW</div>
          <div id="radial-opt-strike" class="radial-opt" style="position: absolute; right: 0; top: 50%; transform: translateY(-50%); width: 100px; height: 100px; border: 2px solid #ff0000; border-radius: 50%; display: flex; align-items: center; justify-content: center; background: rgba(40, 0, 0, 0.6); transition: all 0.2s; color: #ff4444;">STRIKE</div>
          <div id="radial-opt-defend" class="radial-opt" style="position: absolute; bottom: 0; left: 50%; transform: translateX(-50%); width: 100px; height: 100px; border: 2px solid #00aaff; border-radius: 50%; display: flex; align-items: center; justify-content: center; background: rgba(0, 20, 40, 0.6); transition: all 0.2s; color: #00aaff;">DEFEND</div>
          <div id="radial-opt-inventory" class="radial-opt" style="position: absolute; left: 0; top: 50%; transform: translateY(-50%); width: 100px; height: 100px; border: 2px solid #00ffaa; border-radius: 50%; display: flex; align-items: center; justify-content: center; background: rgba(0, 20, 30, 0.8); transition: all 0.2s; color: #00ffff;">UPGRADES</div>
          <div id="radial-opt-aggressive" class="radial-opt" style="position: absolute; top: 15%; right: 15%; width: 100px; height: 100px; border: 2px solid #ffaa00; border-radius: 50%; display: flex; align-items: center; justify-content: center; background: rgba(40, 20, 0, 0.6); transition: all 0.2s; color: #ffaa00;">ATTACK</div>
          <div id="radial-opt-defensive" class="radial-opt" style="position: absolute; bottom: 15%; left: 15%; width: 100px; height: 100px; border: 2px solid #00ffaa; border-radius: 50%; display: flex; align-items: center; justify-content: center; background: rgba(0, 40, 20, 0.6); transition: all 0.2s; color: #00ffaa;">GUARD</div>
      </div>

      <!-- Drone Inventory UI -->
      <div id="inventory-ui" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 300; background: rgba(0, 0, 0, 0.5); pointer-events: auto;">
          <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 600px; height: 400px; background: rgba(0, 10, 20, 0.95); border: 2px solid #00ffff; padding: 20px; box-shadow: 0 0 30px rgba(0, 255, 255, 0.3);">
              <div style="display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #00ffff; padding-bottom: 10px; margin-bottom: 20px;">
                  <div style="font-size: 24px; color: #00ffff;">DRONE UPGRADE SYSTEM</div>
                  <div id="tech-cores-val" style="font-size: 18px; color: #ffff00;">CORES: 0</div>
              </div>
              <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; height: 300px;">
                  <div id="module-list" style="overflow-y: auto; padding-right: 10px;">
                      <div class="module-item" data-type="SHIELD">
                          <div style="font-weight: bold;">SHIELD GENERATOR</div>
                          <div style="font-size: 12px; opacity: 0.8;">Adds an energy shield to the active drone.</div>
                          <div class="cost" style="color: #ffff00; margin-top: 5px;">COST: 1 CORE</div>
                      </div>
                      <div class="module-item" data-type="RAPID_FIRE">
                          <div style="font-weight: bold;">RAPID-FIRE CHIP</div>
                          <div style="font-size: 12px; opacity: 0.8;">Reduces attack cooldown by 50%.</div>
                          <div class="cost" style="color: #ffff00; margin-top: 5px;">COST: 2 CORES</div>
                      </div>
                      <div class="module-item" data-type="HEAVY_LASER">
                          <div style="font-weight: bold;">HEAVY LASER ARRAY</div>
                          <div style="font-size: 12px; opacity: 0.8;">Increases damage by 50%.</div>
                          <div class="cost" style="color: #ffff00; margin-top: 5px;">COST: 2 CORES</div>
                      </div>
                      <div class="module-item" data-type="REPAIR">
                          <div style="font-weight: bold;">NANO-REPAIR SWARM</div>
                          <div style="font-size: 12px; opacity: 0.8;">Slowly repairs drone armor over time.</div>
                          <div class="cost" style="color: #ffff00; margin-top: 5px;">COST: 3 CORES</div>
                      </div>
                      <div class="module-item" data-type="CLOAK">
                          <div style="font-weight: bold;">CLOAKING FIELD</div>
                          <div style="font-size: 12px; opacity: 0.8;">Renders drone invisible to sensors until it attacks.</div>
                          <div class="cost" style="color: #ffff00; margin-top: 5px;">COST: 4 CORES</div>
                      </div>
                      <div class="module-item" data-type="EMP_BURST">
                          <div style="font-weight: bold;">EMP BURST CAPACITOR</div>
                          <div style="font-size: 12px; opacity: 0.8;">Releases an electrical pulse that disables nearby hostiles.</div>
                          <div class="cost" style="color: #ffff00; margin-top: 5px;">COST: 3 CORES</div>
                      </div>
                      <div class="module-item" data-type="SELF_DESTRUCT">
                          <div style="font-weight: bold;">FINAL PROTOCOL</div>
                          <div style="font-size: 12px; opacity: 0.8;">Unit detonates on death, dealing massive AOE damage.</div>
                          <div class="cost" style="color: #ffff00; margin-top: 5px;">COST: 2 CORES</div>
                      </div>
                      <div class="module-item" data-type="CHAIN_LIGHTNING">
                          <div style="font-weight: bold;">CHAIN LIGHTNING</div>
                          <div style="font-size: 12px; opacity: 0.8;">Attacks arc to up to 3 nearby enemies.</div>
                          <div class="cost" style="color: #ffff00; margin-top: 5px;">COST: 3 CORES</div>
                      </div>
                      <div class="module-item" data-type="SWARM">
                          <div style="font-weight: bold;">SWARM CONTROLLER</div>
                          <div style="font-size: 12px; opacity: 0.8;">Summons 4 micro-drones that orbit and protect the player.</div>
                          <div class="cost" style="color: #ffff00; margin-top: 5px;">COST: 5 CORES</div>
                      </div>
                      <div class="module-item" data-type="REPAIR_FIELD">
                          <div style="font-weight: bold;">REPAIR NANITE FIELD</div>
                          <div style="font-size: 12px; opacity: 0.8;">Emits a field that heals the player and nearby allies.</div>
                          <div class="cost" style="color: #ffff00; margin-top: 5px;">COST: 4 CORES</div>
                      </div>
                      <div class="module-item" data-type="OVERCLOCK">
                          <div style="font-weight: bold;">OVERCLOCK EMITTER</div>
                          <div style="font-size: 12px; opacity: 0.8;">Increases move speed and fire rate of nearby allied drones.</div>
                          <div class="cost" style="color: #ffff00; margin-top: 5px;">COST: 4 CORES</div>
                      </div>
                      <div class="module-item" data-type="GRAVITY_SINGULARITY">
                          <div style="font-weight: bold;">GRAVITY SINGULARITY</div>
                          <div style="font-size: 12px; opacity: 0.8;">Periodically pulls nearby enemies into a dense cluster for AOE attacks.</div>
                          <div class="cost" style="color: #ffff00; margin-top: 5px;">COST: 5 CORES</div>
                      </div>
                      <div class="module-item" data-type="VOLATILE_DETONATION">
                          <div style="font-weight: bold;">VOLATILE DETONATION</div>
                          <div style="font-size: 12px; opacity: 0.8;">Causes the Gravity Singularity to detonate for massive damage when its pull ends.</div>
                          <div class="cost" style="color: #ffff00; margin-top: 5px;">COST: 3 CORES</div>
                      </div>
                      <div class="module-item" data-type="KINETIC_CHAIN">
                          <div style="font-weight: bold;">KINETIC CHAIN</div>
                          <div style="font-size: 12px; opacity: 0.8;">Creates arcing electrical damage between enemies caught within the Singularity.</div>
                          <div class="cost" style="color: #ffff00; margin-top: 5px;">COST: 4 CORES</div>
                      </div>
                      <div class="module-item" data-type="MAGNETIC_SIPHON">
                          <div style="font-weight: bold;">MAGNETIC SIPHON</div>
                          <div style="font-size: 12px; opacity: 0.8;">Restores drone armor based on damage dealt by Kinetic Chain arcs (25% lifesteal).</div>
                          <div class="cost" style="color: #ffff00; margin-top: 5px;">COST: 3 CORES</div>
                      </div>
                      <div class="module-item" data-type="SINGULARITY_ECHO">
                          <div style="font-weight: bold;">SINGULARITY ECHO</div>
                          <div style="font-size: 12px; opacity: 0.8;">Spawns a secondary, smaller singularity immediately after the first one expires.</div>
                          <div class="cost" style="color: #ffff00; margin-top: 5px;">COST: 4 CORES</div>
                      </div>
                      <div class="module-item" data-type="GRAVITY_WELL">
                          <div style="font-weight: bold;">GRAVITY WELL</div>
                          <div style="font-size: 12px; opacity: 0.8;">Increases projectile damage against enemies trapped in a singularity by 50%.</div>
                          <div class="cost" style="color: #ffff00; margin-top: 5px;">COST: 3 CORES</div>
                      </div>
                      <div class="module-item" data-type="CRUSHING_PRESSURE">
                          <div style="font-weight: bold;">CRUSHING PRESSURE</div>
                          <div style="font-size: 12px; opacity: 0.8;">Deals scaling damage over time to enemies within the singularity, increasing as they get closer to the center.</div>
                          <div class="cost" style="color: #ffff00; margin-top: 5px;">COST: 4 CORES</div>
                      </div>
                      <div class="module-item" data-type="SINGULARITY_COLLAPSE">
                          <div style="font-weight: bold;">SINGULARITY COLLAPSE</div>
                          <div style="font-size: 12px; opacity: 0.8;">Significantly increases gravitational pull speed, drawing enemies into the epicenter at double velocity.</div>
                          <div class="cost" style="color: #ffff00; margin-top: 5px;">COST: 3 CORES</div>
                      </div>
                      <div class="module-item" data-type="NEUTRON_FLUX">
                          <div style="font-weight: bold;">NEUTRON FLUX</div>
                          <div style="font-size: 12px; opacity: 0.8;">The ultimate singularity upgrade. Triggers a massive, high-damage explosion that also EMP-disables any survivors.</div>
                          <div class="cost" style="color: #ffff00; margin-top: 5px;">COST: 5 CORES</div>
                      </div>
                      <div class="module-item" data-type="CHRONO_DILATION">
                          <div style="font-weight: bold;">CHRONO-DILATION</div>
                          <div style="font-size: 12px; opacity: 0.8;">Distorts time within the singularity, slowing enemy movement and attack speed by 70%.</div>
                          <div class="cost" style="color: #ffff00; margin-top: 5px;">COST: 4 CORES</div>
                      </div>
                      <div class="module-item" data-type="PHASE_SHIFT_CLOAK">
                          <div style="font-weight: bold;">PHASE-SHIFT CLOAK</div>
                          <div style="font-size: 12px; opacity: 0.8;">Grants the drone and player total stealth and invulnerability while within the singularity's influence.</div>
                          <div class="cost" style="color: #ffff00; margin-top: 5px;">COST: 5 CORES</div>
                      </div>
                      <div class="module-item" data-type="RESONANCE_OVERLOAD">
                          <div style="font-weight: bold;">RESONANCE OVERLOAD</div>
                          <div style="font-size: 12px; opacity: 0.8;">Enemies in the singularity share 30% of all incoming damage with each other via acoustic resonance.</div>
                          <div class="cost" style="color: #ffff00; margin-top: 5px;">COST: 4 CORES</div>
                      </div>
                      <div class="module-item" data-type="GAMMA_BURST">
                          <div style="font-weight: bold;">GAMMA BURST</div>
                          <div style="font-size: 12px; opacity: 0.8;">Harnesses the energy of a Neutron Flux explosion to buff the player's damage by 10% for each enemy killed (Lasts 12s).</div>
                          <div class="cost" style="color: #ffff00; margin-top: 5px;">COST: 4 CORES</div>
                      </div>
                  </div>
                  <div id="drone-preview" style="background: rgba(0, 255, 255, 0.05); border: 1px dashed #00ffff; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 20px; text-align: center;">
                      <div id="drone-status-name" style="font-size: 18px; color: #00ffaa;">NO ACTIVE DRONE</div>
                      <div id="drone-status-mods" style="font-size: 12px; margin-top: 10px; color: #aaa;">HACK A DRONE TO BEGIN UPGRADES</div>
                      <button id="apply-upgrade-btn" style="margin-top: 20px; padding: 10px 20px; background: #00ffff; border: none; color: black; font-family: 'Orbitron', sans-serif; cursor: pointer; display: none;">APPLY MODULE</button>
                  </div>
              </div>
              <div style="position: absolute; bottom: 10px; right: 20px; color: #00ffff; font-size: 12px;">[ESC] OR CLICK BACKGROUND TO CLOSE</div>
          </div>
      </div>

      <style>
          .radial-opt.hover { background: rgba(0, 255, 0, 0.4) !important; scale: 1.1; font-weight: bold; }
          .module-item { 
              padding: 10px; border: 1px solid rgba(0, 255, 255, 0.3); margin-bottom: 10px; cursor: pointer; transition: all 0.2s;
          }
          .module-item:hover { background: rgba(0, 255, 255, 0.1); border-color: #00ffff; }
          .module-item.selected { background: rgba(0, 255, 255, 0.2); border-color: #00ffff; box-shadow: 0 0 10px #00ffff; }
          .module-item.owned { opacity: 0.5; cursor: default; }
      </style>

      <div id="health" class="stats">HEALTH: <span id="health-val">100</span></div>
      <div id="grenades" class="stats" style="bottom: 100px; left: 0;">UTILITY: <span id="grenade-count">F:3 E:2</span></div>
      <div id="ammo" class="stats">
        <div id="slot-rifle" class="weapon-slot">
          <div class="ammo-variant-container">
            <img id="rifle-ammo-icon" class="ammo-icon" style="display: none;">
            <div>RIFLE: <span id="rifle-ammo">30 / 60</span></div>
          </div>
          <div id="rifle-mods" class="mod-indicator-container"></div>
        </div>
        <div id="slot-sniper" class="weapon-slot">
          <div class="ammo-variant-container">
            <img id="sniper-ammo-icon" class="ammo-icon" style="display: none;">
            <div>SNIPER: <span id="sniper-ammo">5 / 10</span></div>
          </div>
          <div id="sniper-mods" class="mod-indicator-container"></div>
        </div>
        <div id="slot-ext" class="weapon-slot" style="color: #00aaff;">EXTINGUISHER: <span id="ext-ammo">100%</span></div>
        <div id="slot-turret" class="weapon-slot" style="color: #00ffaa;">SENTRY TURRET: <span id="turret-ammo">2</span></div>
        <div id="thermal-slot" class="weapon-slot" style="color: #00ffaa; margin-top: 10px;">
            THERMAL [T]: <span id="thermal-val">100%</span>
            <div id="thermal-bar-container" style="width: 100%; height: 6px; background: #003300; margin-top: 4px; border: 1px solid #00ffaa;">
                <div id="thermal-bar" style="width: 100%; height: 100%; background: #00ffaa; transition: width 0.1s;"></div>
            </div>
        </div>
        <div id="flashlight-slot" class="weapon-slot" style="color: #ffff00; margin-top: 10px;">
            FLASHLIGHT [L]: <span id="flashlight-val">100%</span>
            <div id="flashlight-bar-container" style="width: 100%; height: 6px; background: #333300; margin-top: 4px; border: 1px solid #ffff00;">
                <div id="flashlight-bar" style="width: 100%; height: 100%; background: #ffff00; transition: width 0.1s;"></div>
            </div>
        </div>
      </div>
      <div id="score" class="stats">SCORE: <span id="score-val">0</span></div>
      <div id="heat-hud" class="stats" style="top: 100px; right: 0; color: #ff3300; font-size: 18px; display: none;">HEAT LEVEL: <span id="heat-val">1</span></div>
      
      <!-- Chamber Progress HUD -->
      <div id="chamber-progress">
          <div id="chamber-progress-label" style="letter-spacing: 2px; color: #00ffaa; font-size: 10px; margin-bottom: 5px;">CHAMBER INTEGRITY: 100%</div>
          <div id="chamber-progress-bar-container">
              <div id="chamber-progress-bar"></div>
          </div>
      </div>

      <div id="tech-cores-hud" class="stats" style="top: 40px; right: 0; color: #ffff00; font-size: 18px;">CORES: <span id="cores-val">0</span></div>
      <div id="scrap-hud" class="stats" style="top: 70px; right: 0; color: #ffaa00; font-size: 18px;">CREDITS: <span id="scrap-val">0</span></div>
      <div id="instructions" style="opacity: 0.8;">[WASD] MOVE | [SPACE] JUMP | [CLICK] SHOOT | [1-4] WEAPONS | [Q] SWAP | [R] RELOAD | [V] MELEE | [G/F] UTILITY | [T] THERMAL | [L] FLASHLIGHT | [X] COMMANDS</div>
    </div>
    <script type="module" src="main.js"></script>
    <script src="https://storage.googleapis.com/rosebud_staticfiles/ChatManager.js"></script>
    <script src="https://storage.googleapis.com/rosebud_staticfiles/ImageGenerator.js"></script>
    <script src="https://storage.googleapis.com/rosebud_staticfiles/ProgressLogger.js"></script>
    <script src="https://storage.googleapis.com/rosebud_staticfiles/OGP.js"></script>
  </body>
</html>
